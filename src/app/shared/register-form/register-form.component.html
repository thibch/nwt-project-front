<h2 mat-dialog-title>Inscription</h2>

<mat-dialog-content>
  <p *ngIf="error">Pseudo ou mail déjà utilisé !</p>

  <form [formGroup]="registerForm" novalidate>
    <table cellspacing="0" class="full-width">
      <tr>
        <td>
          <mat-form-field [class.mgb15]="registerForm.get('firstname')?.dirty && registerForm.get('firstname')?.invalid"
                          class="full-width">
            <input [ngModel]="user.firstname" formControlName="firstname" matInput minlength="2" name="firstname"
                   placeholder="Prénom" required/>
            <mat-error
              *ngIf="registerForm.get('firstname')?.dirty && registerForm.get('firstname')?.hasError('required')">
              Le champ prénom est <strong>requis.</strong>
            </mat-error>
            <mat-error
              *ngIf="registerForm.get('firstname')?.dirty && registerForm.get('firstname')?.hasError('minlength')">
              Le champ prénom doit contenir au minimum <strong>2 charactères.</strong>
            </mat-error>
          </mat-form-field>
        </td>
        <td class="align-right">
          <mat-form-field [class.mgb15]="registerForm.get('lastname')?.dirty && registerForm.get('lastname')?.invalid"
                          class="full-width">
            <input [ngModel]="user.lastname" formControlName="lastname" matInput minlength="2" name="lastname"
                   placeholder="Nom" required/>
            <mat-error
              *ngIf="registerForm.get('lastname')?.dirty && registerForm.get('lastname')?.hasError('required')">
              Le champ nom est <strong>requis.</strong>
            </mat-error>
            <mat-error
              *ngIf="registerForm.get('lastname')?.dirty && registerForm.get('lastname')?.hasError('minlength')">
              Le champ nom doit contenir au minimum <strong>2 charactères.</strong>
            </mat-error>
          </mat-form-field>
        </td>
      </tr>
    </table>
    <p>
      <mat-form-field [class.mgb15]="registerForm.get('username')?.dirty && registerForm.get('username')?.invalid"
                      class="full-width">
        <input [ngModel]="user.username" formControlName="username" matInput minlength="2" name="username" placeholder="Pseudo"
               required/>
        <mat-error *ngIf="registerForm.get('username')?.dirty && registerForm.get('username')?.hasError('required')">
          Le champ pseudo est <strong>requis.</strong>
        </mat-error>
        <mat-error *ngIf="registerForm.get('username')?.dirty && registerForm.get('username')?.hasError('minlength')">
          Le champ pseudo doit contenir au minimum <strong>2 charactères.</strong>
        </mat-error>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field [class.mgb15]="registerForm.get('email')?.dirty && registerForm.get('email')?.invalid"
                      class="full-width">
        <input [ngModel]="user.email" formControlName="email" matInput minlength="8" name="email" placeholder="Mail"
               required type="email"/>
        <mat-error *ngIf="registerForm.get('email')?.dirty && registerForm.get('email')?.hasError('required')">
          Le champ mail est <strong>requis.</strong>
        </mat-error>
        <mat-error *ngIf="registerForm.get('email')?.dirty && registerForm.get('email')?.hasError('minlength')">
          Le champ mail doit contenir au minimum <strong>8 charactères.</strong>
        </mat-error>
        <mat-error *ngIf="registerForm.get('email')?.dirty && registerForm.get('email')?.hasError('regex')">
          Le champ mail doit respecter la syntaxe <strong> text@domaine.extension.</strong>
        </mat-error>
      </mat-form-field>
    </p>
    <table cellspacing="0" class="full-width">
      <tr>
        <td>
          <mat-form-field [class.mgb15]="registerForm.get('password')?.dirty && registerForm.get('password')?.invalid"
                          class="full-width">
            <input [type]="hide?'password':'text'" formControlName="password" matInput minlength="8"
                   name="password" placeholder="Mot de passe"
                   required/>
            <button (click)="hide = !hide" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hide" mat-icon-button
                    matSuffix>
              <mat-icon>{{hide ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>

            <mat-error
              *ngIf="registerForm.get('password')?.dirty && registerForm.get('password')?.hasError('required')">
              Le champ mot de passe est <strong>requis.</strong>
            </mat-error>
            <mat-error
              *ngIf="registerForm.get('password')?.dirty && registerForm.get('password')?.hasError('minlength')">
              Le champ mot de passe doit contenir au minimum <strong>8 charactères.</strong>
            </mat-error>
            <mat-error *ngIf="registerForm.get('password')?.dirty && registerForm.get('password')?.hasError('regex')">
              Le champ mot de passe doit contenir au moins<strong> une majuscule, une minuscule et un chiffre.</strong>
            </mat-error>
          </mat-form-field>

        </td>
        <td class="align-right">
          <mat-form-field [class.mgb15]="registerForm.get('passwordConfirm')?.dirty && registerForm.get('passwordConfirm')?.invalid || registerForm.hasError('diff') "
                          class="full-width">

            <input formControlName="passwordConfirm" matInput name="passwordConfirm" placeholder="Confirmation mot de passe"
                   required type="password"/>


            <mat-error
              *ngIf="registerForm.get('passwordConfirm')?.dirty && registerForm.hasError('matchPasswords')">
              Le mot de passe <strong>est différent !</strong>
            </mat-error>

            <mat-error
              *ngIf="registerForm.get('passwordConfirm')?.dirty && registerForm.get('passwordConfirm')?.hasError('required')">
              Le champ confirmation de mot de passe est <strong>requis.</strong>
            </mat-error>
          </mat-form-field>
        </td>
      </tr>
    </table>
    <p>
      <mat-form-field [class.mgb15]="registerForm.get('photo')?.dirty && registerForm.get('photo')?.invalid"
                      class="full-width">
        <input [ngModel]="user.photo" formControlName="photo" matInput name="photo" placeholder="Lien vers un avatar"/>
      </mat-form-field>
    </p>
    <p>
      <mat-form-field [class.mgb15]="registerForm.get('birthDate')?.dirty && registerForm.get('birthDate')?.invalid"
                      class="full-width">
        <input [ngModel]="user.birthDate" formControlName="birthDate" matInput name="birthDate"
               placeholder="Date de naissance" required type="date"/>
        <mat-error
          *ngIf="registerForm.get('birthDate')?.dirty && registerForm.get('birthDate')?.hasError('required')">
          Le champ date de naissance est <strong>requis.</strong>
        </mat-error>
      </mat-form-field>
    </p>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button (click)="redirectBack()" mat-button type="button">Annuler</button>
  <button (click)="create(registerForm.value)" [disabled]="registerForm.invalid" mat-button type="submit">Création du
    compte
  </button>
</mat-dialog-actions>
